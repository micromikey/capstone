# ğŸ”— Booking & Payment System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HIKETHERE PLATFORM                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   User Auth   â”‚           â”‚   Trail System   â”‚               â”‚
â”‚  â”‚   (Jetstream) â”‚           â”‚   (Organizations)â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚          â”‚                             â”‚                          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                     â–¼                                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚         â”‚   BOOKING SYSTEM      â”‚                                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚         â”‚  â”‚ BookingControllerâ”‚  â”‚                                â”‚
â”‚         â”‚  â”‚   - index()      â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚   - create()     â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚   - store() â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”                         â”‚
â”‚         â”‚  â”‚   - show()       â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚                         â”‚
â”‚         â”‚         â”‚              â”‚     â”‚                         â”‚
â”‚         â”‚         â–¼              â”‚     â”‚                         â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  Booking Model  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ id        â”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ user_id   â”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ trail_id  â”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ batch_id  â”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ date      â”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ party_sizeâ”‚  â”‚  â”‚     â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ status    â”‚â—„â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚  â”‚  â”‚ price_centsâ”‚  â”‚  â”‚     â”‚         â”‚               â”‚
â”‚         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     â”‚         â”‚               â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚         â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚         â”‚               â”‚
â”‚                                        â”‚         â”‚               â”‚
â”‚                                        â–¼         â”‚               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Redirect     â”‚               â”‚
â”‚         â”‚   PAYMENT SYSTEM      â”‚  to Payment   â”‚               â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚         â”‚               â”‚
â”‚         â”‚  â”‚PaymentControllerâ”‚  â”‚     â”‚         â”‚               â”‚
â”‚         â”‚  â”‚  - create() â—„â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”˜         â”‚               â”‚
â”‚         â”‚  â”‚  - processPaymentâ”‚  â”‚               â”‚               â”‚
â”‚         â”‚  â”‚  - success()    â”‚  â”‚               â”‚               â”‚
â”‚         â”‚  â”‚  - webhook() â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                â”‚
â”‚         â”‚         â”‚              â”‚                                â”‚
â”‚         â”‚         â–¼              â”‚                                â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                â”‚
â”‚         â”‚  â”‚BookingPayment   â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚     Model       â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚  â”‚ id        â”‚  â”‚  â”‚                                â”‚
â”‚         â”‚  â”‚  â”‚ booking_idâ”‚â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â” Links to Booking        â”‚
â”‚         â”‚  â”‚  â”‚ user_id   â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ fullname  â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ email     â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ amount    â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ payment_  â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚   status  â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚ paymongo_ â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â”‚   link_id â”‚  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚                         â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                         â”‚
â”‚                     â”‚                   â”‚                         â”‚
â”‚                     â–¼                   â”‚                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                         â”‚
â”‚         â”‚   PAYMONGO API        â”‚       â”‚                         â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚                         â”‚
â”‚         â”‚  â”‚ Create Link     â”‚  â”‚       â”‚                         â”‚
â”‚         â”‚  â”‚ Checkout Page   â”‚  â”‚       â”‚                         â”‚
â”‚         â”‚  â”‚ Webhook Events  â”‚  â”‚       â”‚                         â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                         â”‚
â”‚                                          â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                  One-to-One
                                  Relationship

```

## Data Flow Diagram

```
USER JOURNEY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Step 1: Create Booking
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User visits â”‚
â”‚ booking     â”‚
â”‚ form        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fills:           â”‚
â”‚ â€¢ Trail          â”‚
â”‚ â€¢ Date           â”‚
â”‚ â€¢ Party Size     â”‚
â”‚ â€¢ Notes          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BookingControllerâ”‚
â”‚ store()          â”‚
â”‚                  â”‚
â”‚ Creates Booking: â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚status: conf. â”‚ â”‚
â”‚ â”‚price_cents   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect to:     â”‚
â”‚ /payment/create  â”‚
â”‚ ?booking_id=X    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
Step 2: Payment Form
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PaymentController â”‚
â”‚ create()         â”‚
â”‚                  â”‚
â”‚ Loads Booking    â”‚
â”‚ Pre-fills form   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User sees:       â”‚
â”‚ âœ“ Name (filled)  â”‚
â”‚ âœ“ Email (filled) â”‚
â”‚ âœ“ Trail (readonlyâ”‚
â”‚ âœ“ Date (readonly)â”‚
â”‚ âœ“ Amount (locked)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
Step 3: Process Payment
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks:     â”‚
â”‚ "Proceed to      â”‚
â”‚  Payment"        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PaymentController â”‚
â”‚ processPayment() â”‚
â”‚                  â”‚
â”‚ Creates/Updates: â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚BookingPaymentâ”‚ â”‚
â”‚ â”‚booking_id=X  â”‚ â”‚
â”‚ â”‚status:pendingâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calls PayMongo   â”‚
â”‚ API              â”‚
â”‚                  â”‚
â”‚ Gets checkout_urlâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
Step 4: PayMongo Checkout
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect to:     â”‚
â”‚ PayMongo         â”‚
â”‚ Checkout Page    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User enters:     â”‚
â”‚ â€¢ Card Number    â”‚
â”‚ â€¢ Expiry         â”‚
â”‚ â€¢ CVC            â”‚
â”‚ â€¢ Name           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Payment          â”‚
â”‚ Processed        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
Step 5: Webhook Notification
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PayMongo sends   â”‚
â”‚ webhook to:      â”‚
â”‚ /payment/webhook â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PaymentController â”‚
â”‚ webhook()        â”‚
â”‚                  â”‚
â”‚ Updates:         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Payment       â”‚ â”‚
â”‚ â”‚status: paid  â”‚ â”‚
â”‚ â”‚paid_at: now  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Booking       â”‚ â”‚
â”‚ â”‚status: conf. â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
Step 6: Success Page
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User redirected  â”‚
â”‚ to success page  â”‚
â”‚                  â”‚
â”‚ Shows:           â”‚
â”‚ âœ“ Payment ID     â”‚
â”‚ âœ“ Booking ID     â”‚
â”‚ âœ“ Amount         â”‚
â”‚ âœ“ Status: PAID   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Relationships

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TABLES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  users                           trails                          â”‚
â”‚  â”œâ”€ id (PK)                      â”œâ”€ id (PK)                      â”‚
â”‚  â”œâ”€ name                         â”œâ”€ user_id (FKâ†’users)           â”‚
â”‚  â”œâ”€ email                        â”œâ”€ trail_name                   â”‚
â”‚  â””â”€ ...                          â”œâ”€ mountain_name                â”‚
â”‚       â–²                          â”œâ”€ price                        â”‚
â”‚       â”‚                          â””â”€ ...                          â”‚
â”‚       â”‚                               â–²                          â”‚
â”‚       â”‚                               â”‚                          â”‚
â”‚       â”‚                               â”‚                          â”‚
â”‚  bookings                             â”‚                          â”‚
â”‚  â”œâ”€ id (PK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                          â”‚
â”‚  â”œâ”€ user_id (FKâ†’users) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚â”‚                          â”‚
â”‚  â”œâ”€ trail_id (FKâ†’trails) â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜â”‚                          â”‚
â”‚  â”œâ”€ batch_id (FKâ†’batches)        â”‚     â”‚                          â”‚
â”‚  â”œâ”€ event_id (FKâ†’events)         â”‚     â”‚                          â”‚
â”‚  â”œâ”€ date                          â”‚     â”‚                          â”‚
â”‚  â”œâ”€ party_size                    â”‚     â”‚                          â”‚
â”‚  â”œâ”€ status â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”                      â”‚
â”‚  â”œâ”€ notes                         â”‚     â”‚  â”‚ Updated by          â”‚
â”‚  â”œâ”€ price_cents                   â”‚     â”‚  â”‚ webhook             â”‚
â”‚  â”œâ”€ created_at                    â”‚     â”‚  â”‚                      â”‚
â”‚  â””â”€ updated_at                    â”‚     â”‚  â”‚                      â”‚
â”‚       â–²                           â”‚     â”‚  â”‚                      â”‚
â”‚       â”‚                           â”‚     â”‚  â”‚                      â”‚
â”‚       â”‚ ONE-TO-ONE               â”‚     â”‚  â”‚                      â”‚
â”‚       â”‚                           â”‚     â”‚  â”‚                      â”‚
â”‚  booking_payments                 â”‚     â”‚  â”‚                      â”‚
â”‚  â”œâ”€ id (PK)                       â”‚     â”‚  â”‚                      â”‚
â”‚  â”œâ”€ booking_id (FKâ†’bookings) â”€â”€â”€â”€â”€â”˜     â”‚  â”‚                      â”‚
â”‚  â”œâ”€ user_id (FKâ†’users) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚
â”‚  â”œâ”€ fullname                               â”‚                      â”‚
â”‚  â”œâ”€ email                                  â”‚                      â”‚
â”‚  â”œâ”€ phone                                  â”‚                      â”‚
â”‚  â”œâ”€ mountain                               â”‚                      â”‚
â”‚  â”œâ”€ amount                                 â”‚                      â”‚
â”‚  â”œâ”€ hike_date                              â”‚                      â”‚
â”‚  â”œâ”€ participants                           â”‚                      â”‚
â”‚  â”œâ”€ paymongo_link_id                       â”‚                      â”‚
â”‚  â”œâ”€ paymongo_payment_id                    â”‚                      â”‚
â”‚  â”œâ”€ payment_status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚  â”‚   (pending/paid/failed/refunded)                              â”‚
â”‚  â”œâ”€ paid_at                                                       â”‚
â”‚  â”œâ”€ created_at                                                    â”‚
â”‚  â””â”€ updated_at                                                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INDEXES:
  bookings: user_id, trail_id, batch_id, status
  booking_payments: booking_id, user_id, payment_status
  booking_payments: [booking_id, payment_status] (composite)
```

## API Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ROUTES (web.php)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  BOOKING ROUTES (Authenticated)                                 â”‚
â”‚  â”œâ”€ GET  /hiker/booking                                          â”‚
â”‚  â”‚       â†’ BookingController@index                              â”‚
â”‚  â”‚       Shows list of user's bookings                          â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ GET  /hiker/booking/create                                   â”‚
â”‚  â”‚       â†’ BookingController@create                             â”‚
â”‚  â”‚       Shows booking form                                     â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ POST /hiker/booking                                          â”‚
â”‚  â”‚       â†’ BookingController@store                              â”‚
â”‚  â”‚       Creates booking â†’ Redirects to payment                 â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ GET  /hiker/booking/{booking}                                â”‚
â”‚          â†’ BookingController@show                               â”‚
â”‚          Shows booking details                                  â”‚
â”‚                                                                   â”‚
â”‚  PAYMENT ROUTES (Authenticated)                                 â”‚
â”‚  â”œâ”€ GET  /payment/create?booking_id=X                            â”‚
â”‚  â”‚       â†’ PaymentController@create                             â”‚
â”‚  â”‚       Shows payment form (pre-filled if booking_id)          â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ POST /payment/process                                        â”‚
â”‚  â”‚       â†’ PaymentController@processPayment                     â”‚
â”‚  â”‚       Creates payment â†’ Redirects to PayMongo                â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€ GET  /payment/success?payment_id=X                           â”‚
â”‚  â”‚       â†’ PaymentController@success                            â”‚
â”‚  â”‚       Shows payment confirmation                             â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ POST /payment/webhook (Public - called by PayMongo)          â”‚
â”‚          â†’ PaymentController@webhook                            â”‚
â”‚          Updates payment & booking status                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Status Flow Chart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STATUS LIFECYCLE                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BOOKING STATUS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    [Created]
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚confirmed â”‚ â† Initial status (provisional)
  â”‚          â”‚   Awaiting payment
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º Payment completed
       â”‚        â”‚
       â”‚        â–¼
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚confirmed â”‚ â† Final status
       â”‚   â”‚(finalized)
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â–º Payment expired (24h+)
                â”‚
                â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ expired  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PAYMENT STATUS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    [Created]
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ pending  â”‚ â† Awaiting user payment
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º User pays on PayMongo
       â”‚        â”‚
       â”‚        â–¼
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚   paid   â”‚ â† Payment successful
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â–º Payment fails
       â”‚        â”‚
       â”‚        â–¼
       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   â”‚  failed  â”‚ â† Can retry
       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â–º Admin initiates refund
                â”‚
                â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ refunded â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            EXTERNAL INTEGRATIONS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. PayMongo Payment Gateway                                   â”‚
â”‚     â”œâ”€ API Endpoint: https://api.paymongo.com/v1/links        â”‚
â”‚     â”œâ”€ Authentication: Basic Auth (secret key)                 â”‚
â”‚     â”œâ”€ Actions:                                                â”‚
â”‚     â”‚  â”œâ”€ Create payment link                                  â”‚
â”‚     â”‚  â”œâ”€ Redirect to checkout                                 â”‚
â”‚     â”‚  â””â”€ Receive webhook notifications                        â”‚
â”‚     â””â”€ Events:                                                 â”‚
â”‚        â””â”€ link.payment.paid                                    â”‚
â”‚                                                                  â”‚
â”‚  2. Email Service (Future)                                     â”‚
â”‚     â”œâ”€ Booking confirmation                                    â”‚
â”‚     â”œâ”€ Payment receipt                                         â”‚
â”‚     â””â”€ Payment reminder                                        â”‚
â”‚                                                                  â”‚
â”‚  3. SMS Notifications (Future)                                 â”‚
â”‚     â”œâ”€ Booking confirmation                                    â”‚
â”‚     â””â”€ Payment reminder                                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**System Architecture Complete!**
**Last Updated**: October 2, 2025
**Version**: 1.0.0
